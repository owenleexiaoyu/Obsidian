## 原生开发

原生应用：某个移动平台所的特有的应用，使用对应平台支持的开发工具和语言，并直接调用系统提供的 SDK API。比如 Android 使用 Java 或 Kotlin 开发，iOS 使用 Objective-C 或 Swift 开发，它们就被称为原生开发。

优点：

-   可访问平台全部功能（GPS、摄像头）
-   速度快、性能高、可以实现复杂动画及绘制，整体用户体验好

缺点：

-   平台特定，开发成本高；不同平台必须维护不同代码，人力成本变大
-   内容固定，动态化弱，大多数情况下，有新功能更新只能发版

## 跨平台技术

这里的跨平台一般指跨 Android、iOS

根据原理，可以分为三类：

-   H5 + 原生（Cordova、Ionic、微信小程序）

-   JavaScript 开发+原生渲染 （React Native、Weex、快应用）

-   自绘 UI+原生（QT for mobile、Flutter）

### Hybrid 技术简介

H5+原生（Native）的开发模式被称为混合开发（Hybrid）

主要原理：将 App 的一部分需要动态变动的内容通过 H5 实现，通过原生的WebView（Android：WebView；iOS：WKWebView）来加载。

-   **动态化**：H5 部分可以随时改变而不用发版
-   **跨平台**：一份代码可以同时在  Android 和 iOS 两个平台运行

在混合开发中，H5 代码是运行在 WebView 中，这是一个权限受限的沙箱，对于大多数系统能力都无法调用，如无法访问文件系统、不能使用蓝牙。这部分都需要原生来实现，混合框架会在原生代码中预先实现一些访问系统能力的 API，然后暴露给 WebView 以供 JS 调用，WebView 就成为了 JS 和原生 API 之间通信的桥梁，负责 JS 和原生之间传递调用消息。消息的传递必须遵守一个标准协议，来规定消息的格式和含义，这个被称为 WebView JavaScript Bridge，简称 JsBridge 或 JSB，它是混合开发框架的核心。

混合应用的优点：

- 动态内容是 H5，Web 技术栈，社区及资源丰富

缺点：

- 性能不好，对于复杂用户界面或动画，WebView 不堪重任

### React Native、Weex 及快应用

RN 是 Facebook 开源的跨平台框架，支持 iOS 和 Android，RN 使用 JS、类似于 HTML 的 JSX、和 CSS 来开发移动应用。

这里我们先来看两个概念，以便更好地理解 RN 的设计思想。

#### DOM 树和控件树

DOM：Document Object Model（文档对象模型），是 W3C 组织推荐的处理可扩展标志语言的标准编程接口，一种独立于平台和语言的方式访问和修改一个文档的内容和结构。换句话说，这是表示和处理一个 HTML 或 XML 文档的标准接口。简单来说，DOM 树就是文档树，于用户界面控件树对应，在前端常指 HTML 对应的渲染树，广义的 DOM 树也可以指 Android 中 XML 布局文件对应的控件树。DOM 操作就是指直接来操作控件树。

#### 响应式编程

React 是一个响应式的 Web 框架。React 提出一个重要概念：UI 随状态改变。这就是**响应式编程**范式。

React 中响应式编程原理：

-   开发者只需关注状态转移（数据），当状态发生变化，React 框架会自动根据最新的状态重新构建 UI。
-   React 框架在接受到用户状态改变通知后，会根据当前渲染树，结合最新的状态改变，通过 Diff 算法，计算出树中变化的部分，然后只更新变化的部分（DOM 操作），从而避免整棵树重构，提升性能。

第二步中，状态变化后，不会立即去计算并渲染DOM树的变化部分，React框架会在DOM的基础上建立一个抽象层，叫做虚拟DOM树，对数据和状态的改动，会立即高效地同步到虚拟DOM，再批量地同步到真实的DOM上，提高性能。

React Native 是 React 在原生移动应用的衍生，两者的区别在于虚拟DOM映射的对象是什么。React 中，是浏览器DOM树，RN中是通过JavaScriptCore映射为原生控件树。

JavaScriptCore 是一个JS解释器，它在RN中主要有两个作用：

-   为JS提供运行环境
-   是JS与原生应用之间通信的桥梁，作用和JSB一样（iOS中，很多JSB实现都是基于JavaScriptCore）

RN将虚拟DOM映射为原生控件分两步：

-   布局消息传递，将虚拟DOM布局信息传递给原生
-   原生根据布局信息通过对应的原生控件渲染控件树

相对于H5，RN是原生渲染，所以性能会比H5好很多。

Weex

Weex是阿里2016年发布的跨端框架，思想和原理和RN类似，最大的不同是语法层面，Weex支持Vue语法和Rax语法，RN只支持JSX。

快应用

快应用是华为、小米、OPPO、每周等国内9打主流手机厂商共同制定的轻量级应用标准。它也是采用JS开发，原生控件渲染，和RN、Weex相比主要有两点不同：

-   快应用自身不支持Vue或React语法，其采用原生JS开发，开发框架和微信小程序很像。
-   RN、Weex的渲染/排版引擎是集成到框架内的，每个应用都需要打包一份，安装包体积较大，快应用渲染/排版是集成到ROM中的，应用中无需大包，安装包体积小。正因如此，快应用才能在保证性能的同时做到快速分发。

总结

JS开发+原生渲染的主要优点：

-   采用Web技术栈，社区庞大，上手快，开发成本相对较低
-   原生渲染，性能相比H5提高很多
-   动态化较好，支持热更新

不足：

-   渲染时需要JS和原生之间通信，有些场景如拖动可能会因为通信频繁导致卡顿
-   由于渲染依赖原生控件，不同平台的控件需要单独维护，并且当系统更新是，社区控件可能会滞后。另外，控件系统也会受到原生UI系统的限制。比如，在Android中，手势冲突消歧规则是固定的，这在使用不同人写的控件嵌套时，手势冲突问题将会变得非常棘手。

自绘UI+原生

这种技术的思路是：通过在不同平台实现一个统一接口的渲染引擎来绘制UI，而不依赖系统原生控件，所以可以做到不同平台的UI一致性。注意，自绘引擎解决的是UI的跨平台问题，如果涉及其他系统能力调用，依赖要涉及原生开发。

优点如下：

-   性能高：由于自绘引擎是直接调用系统API来绘制UI，所以性能和原生控件接近
-   灵活、组件库以维护、UI外观保真度和一致性高。

不足：

-   动态性不足，为了保证UI绘制性能，自绘UI系统一般会采用AOTHERS模式编译其发布包，所以应用发布后，不能像Hybrid或RN那些使用JS开发的框架那样动态下发代码

QT Mobile

QT 是自绘引擎的先驱，支持了Android、iOS、WP，在PC上获得巨大成功，但在移动端一直表现不佳，算是失败了，原因有以下几点：

-   QT移动开发社区太小，学习资料不足，生态不好
-   官方推广不利，支持不够
-   移动端发力较晚，时长已被其他动态化框架占领（Hybrid和RN）
-   在移动开发中，C++开发和Web开发栈相比有先天的劣势，直接结果就是QT开发效率太低。

Flutter

Flutter是Google发布的一个用于创建跨平台、高性能移动应用应用的框架。和QT一样，都没有使用原生控件，有自绘引擎，使用自身的布局、绘制系统。

和QT对比：

-   生态：Flutter活跃用户在高速增长，社区也已经很庞大，文档和资源越来越丰富。
-   技术支持：Google正在大力推广Flutter，迭代也很频繁，投入资源很大。
-   开发效率：Flutter热重载可以帮助开发者快速地进行测试、构建UI、添加功能并快速修复错误，可以实现毫秒级热重载，并且不会丢失状态。

跨平台技术对比

Unable to copy while content loads

开发效率，是指整个开发周期的效率，包括编码时间、调试时间、以及排错、兼容时间。动态化主要指是否支持动态下发代码和是否支持热更新。值得注意的是Flutter的Release包默认是使用Dart AOT模式编译的，所以不支持动态化，但Dart还有JIT或snapshot运行方式，这些模式都是支持动态化的。