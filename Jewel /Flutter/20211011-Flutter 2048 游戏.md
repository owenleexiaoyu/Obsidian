最近在学习 Flutter 的一些知识，想着独立写一个小示例来运用一下所学的东西，所以就有了这个Flutter 版本 2048 小游戏的项目。完整代码请戳 [Github]()。

2048 小游戏曾经也是风靡一时呀，应该很多人都玩过，不过我们还是简单说一下这个游戏的机制，这里有个网页版的 [2048](https://play2048.co/)，大家可以实际体验一下。一般来说，它是一个 4 * 4 的棋盘，共有 16 个小格子，每个格子中，要么是空格，要么有一个数字，玩家可以上下左右四个方向去滑动（或者通过键盘方向键控制）。当左右滑动时，同一行上数字格子会被移到最左端或者最右端，中间没有空格，相邻的相同数字的格子合并成一个，数字是之前两个格子数字之和，比如 2 和 2 会合并成 4 和 空格。每次滑动后有格子移动时，就会在棋盘的空格里随机生成一个数字。终极的目标是合并出 2048 这个数字。

好的，介绍完这个游戏怎么玩后，我们就可以进入正题，开始实现我们 Flutter 版本的 2048 了。

我们最终实现的效果如下：

<img src="https://gitee.com/owenlee233/image_store/raw/master/202110241555714.png" alt="UI" style="zoom:33%;" />

### 界面元素

从上面的效果图我们可以看到，这个游戏界面可以分为两部分，一个是上方的标题、分数、历史最高分、重新开始游戏按钮等元素：

<img src="https://gitee.com/owenlee233/image_store/raw/master/202110241558113.png" alt="header" style="zoom:33%;" />

一个是下方的棋盘部分，有 4 * 4 个小格子：

<img src="https://gitee.com/owenlee233/image_store/raw/master/202110241559350.png" alt="panel" style="zoom:33%;" />

如果游戏结束时，这部分上面还会盖有一个游戏结束的蒙层：

<img src="https://gitee.com/owenlee233/image_store/raw/master/202110241601378.png" alt="mask" style="zoom:33%;" />

游戏整体 UI 的代码，精简一下是这样的：

```dart
class Game2048Page extends StatefulWidget {
  @override
  _Game2048PageState createState() => _Game2048PageState();
}

class _Game2048PageState extends State<Game2048Page> {

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      extendBodyBehindAppBar: true,
      body: Container(
        padding: EdgeInsets.only(top: 30),
        color: GameColors.bgColor1,
        child: Column(
          children: [
            Flexible(child: gameHeader()),
            Flexible(flex: 2,child: Game2048Panel())
          ],
        )
      ),
    );
  }

  Widget gameHeader() {
    return Container();
  }
}
```

因为界面里需要展示变化的当前分数和历史最高分数，所以 `Game2048Page` 是继承自 `StatefulWidget`。布局结构整体是一个 Column 的垂直方向布局，上面是 `gameHeader()`，抽成了一个方法，里面就是标题、描述、分数等信息，下面是 `Game2048Panel` 表示棋盘，定义成了一个 Widget。

#### Header 部分

Header 部分比较简单，就粗略介绍一下，我们需要展示当前的分数和历史最高分，所以在 `_Game2048PageState` 中定义两个变量，并在相应的 UI 元素中展示出来：

```dart
class _Game2048PageState extends State<Game2048Page> {

  /// 当前分数
  int currentScore = 0;
  /// 历史最高分
  int highestScore = 0;
 
  
}
```



首先我们先来构造这个游戏的数据源，4 * 4 的棋盘，棋盘中每个格子要么是空的，要么是数字，我们很容易能想到用一个 int 的二维数组来表示它，空格子我们用 0 来表示。



